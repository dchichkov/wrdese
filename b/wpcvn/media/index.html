<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
  <html>
  <head> <title>WP CVN</title> </head>

<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/themes/smoothness/jquery-ui.css"/>
<link rel="stylesheet" type="text/css" href="m/datatables/media/css/demo_table_jui.css" />
<link rel="stylesheet" type="text/css" href="m/css/layout-default-latest.css" />


<style type="text/css" title="currentStyle">
	body {font-size: 85%;}	
	table {font-size: 1em;}	

	.fg-button {font-size: 75%;}

  table td {white-space: nowrap;}
  .toolbar {float:left; margin-top:3px; margin-right:3px;}


	/* Layout Theme */
	.ui-layout-pane { 
		padding:	0px; 
		overflow:	hidden;
	} 
	.ui-layout-pane-north { 
		padding:	5px; 
		overflow:	hidden;
	}
	
	.ui-layout-south {
		display:	none;
		overflow:	hidden;
	}
	iframe {
		padding:	0 !important; /* iframes should not have padding */
		overflow:	auto !important;		
	}

	
</style>

<script type="text/javascript" language="javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" language="javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
<script type="text/javascript" language="javascript" src="m/datatables/media/js/jquery.dataTables.js"></script>
<script type="text/javascript" language="javascript" src="m/js/jquery.timeFormat.js"></script>
<script type="text/javascript" language="javascript" src="m/js/jquery.cookie.js"></script>
<script type="text/javascript" language="javascript" src="m/js/jquery.Guid.js"></script>
<script type="text/javascript" language="javascript" src="m/js/jquery.layout-latest.js"></script>


<script type="text/javascript" charset="utf-8">
	var t, tid;
	
	function ellipsis(text, n) {
    if(text.length>n)
        return text.substring(0,n)+"...";
    else
        return text;	
	}

    function login()
    {
		//$.get("s/tid", function(data){
        //		alert( "Your ip: " + data.ip);
		//		}

		
        //tid = $.cookie('tid_cookie')
        //if(tid)
        // {
        //     $.get("s/tid", function(data){
        //         alert( "Your ip: " + data.ip);
        //     });
        // }

        // $.cookie('tid_cookie', 'the_value'); // set cookie
        // $.cookie('tid_cookie', 'the_value', { expires: 7 }); // set cookie with an expiration date seven days in the future
        // $.cookie('the_cookie', '', { expires: -1 }); // delete cookie

        // var $dialog = $('<div></div>')
        //    .html('Establishing connection...<br>' + jQuery.Guid.New())
        //    .dialog({title: 'Welcome.'});
        
        // $.get("s/ip", function(data){
        //    alert( "Your ip: " + data.ip);
		//		});

    }


  $(document).ready(function() {  		
	// Generic Setup 
	$.ajaxSetup('timeout', 1000)
		  
	// Try authentication  		
    login();
	
	// Enable jQuery Layout 
	myLayout = $("body").layout({
		initClosed:		false
	,	north__size:	40
	,	south__size:	222
	,	west__size:		200
	,	autoStateManagement:	true	// enable state management	
	,	useStateCookie:		true		// enable state autoSave
	});
	

	// Main Window datatable 	
  	t = $('#table').dataTable({
		
		"fnRowCallback": function( nRow, aData, iDisplayIndex ) {
                            var $cell=$('td:eq(0)', nRow);
                            $cell.text( $.timeFormat($cell.text()) );

							
                            var $cell=$('td:eq(1)', nRow);
							if($cell.text() < -5) $cell.css({fontWeight:"bold", color:"#FF0000"}); 
							else if($cell.text() < 0) $cell.css("color", "#FF0000");
							else if($cell.text() > 100) $cell.css("color", "#348017");
						
							
                            var $cell=$('td:eq(4)', nRow);
                            $cell.text(ellipsis($cell.text(),25));

							
                            var $cell=$('td:eq(5)', nRow);
							page = $cell.text()
                            $cell.text(ellipsis($cell.text(),25));
							
                            var $cell=$('td:eq(6)', nRow);
							page = $cell.text()
                            $cell.text(ellipsis($cell.text(),50));
							
                            var $cell=$('td:eq(3)', nRow);
                            $cell.html('<a href="' + $cell.text() + ' " target="_blank">diff...</a>');
							$cell.attr("alt", page)
							$cell.click(function() {$.post("s/c", $(this).attr("alt"));});
                            return nRow;
                    },
        "bJQueryUI": true,
        "sPaginationType": "full_numbers",
        "bProcessing": false,
        "bServerSide": true,
		"bAutoWidth": false,
        "sAjaxSource": "s/w",
		"sDom": '<"H" <"toolbar"> lfr >t<"F"ip>',
        "fnServerData": function (sSource, aoData, fnCallback) {
			$.ajax ( {"dataType": 'json', "type": "POST", "url": sSource, "data": aoData, "success": fnCallback} );		
         }
     } );
	 
	 // Main Window datatable Toolbar/Refresh
	 $("div.toolbar").html('<div id="refresh" class="ui-state-default ui-corner-all"><span class="ui-icon ui-icon-refresh">close</span></div>')
	 refresh = $("#refresh")
	 window.setInterval(function() {t.fnDraw();}, 2000);
	 $(document).ajaxSend(function(r,s) {refresh.addClass('ui-state-highlight')});
	 $(document).ajaxStop(function(r,s) {refresh.removeClass('ui-state-highlight')});
	 $(document).ajaxError(function(r,s) {refresh.addClass('ui-state-error')});
	 $(document).ajaxSuccess(function(r,s) {refresh.removeClass('ui-state-error')});


	// Users datatable
  	users = $('#users').dataTable({
		
		"fnRowCallback": function( nRow, aData, iDisplayIndex ) {
                            var $cell=$('td:eq(0)', nRow);
                            $cell.text( $.timeFormat($cell.text()) );
                            return nRow;
                    },
		"aoColumns": [{ "bSortable": false }, { "bSortable": false }],
        "bJQueryUI": true,
        "bProcessing": false,
        "bFilter": false,
		"bLengthChange": false,
		// "bSort": false,
		"bInfo": false,
        "bServerSide": true,
		"bAutoWidth": true,
        "sAjaxSource": "s/users",
        "fnServerData": function (sSource, aoData, fnCallback) {
            $.ajax ( {"dataType": 'json', "type": "GET", "url": sSource, "data": aoData, "success": fnCallback} );
         }
     } );

	// Misc
	$("#autoconfirm").button({icons: {primary: 'ui-icon-locked'}})

  } );
</script>


<body>  
	<div id="status" class="ui-layout-north">
		<form id="status" action="s/status" method="post"> 
    		Nick: <input class="ui-corner-all" type="text" ip="name" /> 
    		<button id="autoconfirm" class="fg-button ui-state-default ui-corner-all">Autoconfirm...</button> 
		</form>			
	</div>



	<div class="ui-layout-center">
		<table cellspacing="0" border="0" class="display ui-helper-reset" id="table">
		        <thead>
		                <tr>
		                        <th width="10%">Time</th>
		                        <th width="5%">Trust</th>
		                        <th width="3%">Views</th>
		                        <th width="3%">Url</th>
		                        <th width="10%">User</th>
		                        <th width="20%">Page</th>
		                        <th width="50%">Summary</th>
		                </tr>
		        </thead>
		        <tbody>
		        </tbody>
		</table>
	</div>
	
	
	<div class="ui-layout-west">
		<table cellspacing="0" border="0" class="display" id="users">
		        <thead>
		                <tr>
		                        <th width="60%">User</th>
		                        <th width="30%">Seen</th>
		                </tr>
		        </thead>
		        <tbody>
		        </tbody>
		</table>
	</div>
	
	<div class="ui-layout-south">	
		<!-- iframe src="http://webchat.freenode.net?channels=countervandalism" width="100%" height="100%" frameborder="0"></iframe -->
	</div>

</body>
</html>
